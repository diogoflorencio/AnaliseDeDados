---
title: "Problema 4 - Checkpoint 3"
author: "Diogo Florêncio"
output: 
  html_notebook:
    theme: lumen
    fig_width: 7
    toc: true
    toc_float: true
editor_options: 
  chunk_output_type: inline
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(highcharter)
library(dplyr)
library(GGally)
library(lubridate)
library(resample)
library(dplyr)
theme_set(theme_bw())
```
#Os dados
Os dados compõe uma amostra de dados da atividade global do github, neles contém a contagem de quantas pessoas editaram arquivos para cada extensão de arquivo no período de 2016 à 2017. Estes dados estão disponíveis [aqui](https://raw.githubusercontent.com/nazareno/fpcc2/master/datasets/github-users-committing-filetypes.csv). Para essa análise as extensões consideradas foram `.java` e `.py`. Objetivo dessa análise é estudar a `popularidade` dessas extensões durante a semana e aos finais de semana.
```{r}
amostra <- read.csv("../dados/github-users-committing-filetypes.csv")

#formatando data
amostra = amostra %>%
        mutate(date = as.Date(paste(month_day,the_month,the_year),format = "%d %m %Y")) %>%
        mutate(week_day = (weekdays(as.Date(date))))%>%
        select(file_extension, week_day, date, users) 
```
#Como se comporta a popularidade de java e python no periodo de 2016 à 2017?
Para responder essa pergunta vamos estimar a popularidade das linguagens para cada ano  e depois comparar suas proporções individualmente. O parâmetro utilizado para mensurar a popularidade de cada linguagem foi a quantidade média de edições. A amostra descreve edições em arquivos até maio de 2017, a fim equiparar a análise considerei apenas o periodo de janeiro à abril de cada ano.  
```{r}
#filtrando dados de interesse
java_2016 = filter(amostra, file_extension == "java", 
                          month(date) %in% c("1","2","3","4"),
                          year(date) == "2016") 

java_2017 = filter(amostra, file_extension == "java",
                          month(date) %in% c("1","2","3","4"),
                          year(date) == "2017") 

py_2016 = filter(amostra, file_extension == "py", 
                          month(date) %in% c("1","2","3","4"),
                          year(date) == "2016") 

py_2017 = filter(amostra, file_extension == "py", 
                          month(date) %in% c("1","2","3","4"),
                          year(date) == "2017")
```
###Popularidade de Java
Análisando a amostra por meio do método bootstrap estimei valores médios da popularidade de `java`, durante a semana para cada ano. A análise foi realizada com confiança de 95%, o bootstrap gerou 10.000 reamostragens. Os resultados foram bem expressivos, a média de edições durante a semana foi estimada em [3372.143 ; 3661.223] para 2016 e [2875.486 ; 3136.426] para 2017.
```{r}
#gerando a estimativa por meio de bootstrap
estimativa_java_2016 =  bootstrap(java_2016, mean(users)) %>% 
                    CI.percentile(probs = c(.025, .975)) %>% 
                    as.data.frame() %>%
                    mutate(year = "2016")
 
#gerando a estimativa por meio de bootstrap
estimativa_java_2017 =  bootstrap(java_2017, mean(users)) %>% 
                    CI.percentile(probs = c(.025, .975)) %>% 
                    as.data.frame() %>%
                    mutate(year = "2017")

#plotando estimativa de popularidade por ano 
data.frame(rbind(estimativa_java_2016, estimativa_java_2017)) %>% 
  ggplot(aes(x = year, ymin = X2.5., ymax = X97.5., color = year)) + 
  geom_errorbar(width = .2)+
  ggtitle("Popularidade de java 2016 - 2017")
```
A diferença de popularidade no periodo de interesse é sigficativa, a estimativa aponta uma queda na popularidade de `java`. Este resultado é relavante pois sugere que os desenvolvedores, por algum motivo, estejam trocando `java` por outras tecnologias.

###Popularidade de Python

Análisando a amostra por meio do método bootstrap estimei valores médios da popularidade de `python`, durante a semana para cada ano. A análise também foi realizada com confiança de 95%, o bootstrap gerou 10.000 reamostragens. A média de edições durante a semana foi estimada em 4223.511 ; 4626.306] para 2016 e [3803.883 ; 4177.364] para 2017.
```{r}
#gerando a estimativa por meio de bootstrap
estimativa_py_2016 =  bootstrap(py_2016, mean(users)) %>% 
                    CI.percentile(probs = c(.025, .975)) %>% 
                    as.data.frame() %>%
                    mutate(year = "2016")

#gerando a estimativa por meio de bootstrap
estimativa_py_2017 =  bootstrap(py_2017, mean(users)) %>% 
                    CI.percentile(probs = c(.025, .975)) %>% 
                    as.data.frame() %>%
                    mutate(year = "2017")

#plotando estimativa de popularidade por ano 
data.frame(rbind(estimativa_py_2016, estimativa_py_2017)) %>% 
  ggplot(aes(x = year, ymin = X2.5., ymax = X97.5., color = year)) + 
  geom_errorbar(width = .2)+
  ggtitle("Popularidade de python 2016 - 2017")
```
#Qual linguagem teve a maior queda de popularidade?
Para responder essa pergunta

```{r}
# distribuição amostral da popularidade de java com 1000 elementos
dist_popularidade_java = data.frame(dist_popularidade_java = 1:1000) %>% 
            group_by(dist_popularidade_java) %>% 
            do(data.frame(media_2016 = sample(java_2016$users, 100) %>% mean(),
                          media_2017 = sample(java_2017$users, 100) %>% mean()))

# distribuição amostral da popularidade de python com 1000 elementos
dist_popularidade_py = data.frame(dist_popularidade_py = 1:1000) %>% 
            group_by(dist_popularidade_py) %>% 
            do(data.frame(media_2016 = sample(py_2016$users, 100) %>% mean(),
                          media_2017 = sample(py_2017$users, 100) %>% mean()))

#gerando estimativa da diferença de popularidade por meio de bootstrap
dif_popularidade_java =  bootstrap(dist_popularidade_java, mean(media_2016/media_2017)) %>% 
                        CI.percentile(probs = c(.025, .975)) %>% 
                        as.data.frame() %>%
                        mutate(linguagem = "java")

dif_popularidade_py =  bootstrap(dist_popularidade_py, mean(media_2016/media_2017)) %>% 
                        CI.percentile(probs = c(.025, .975)) %>% 
                        as.data.frame() %>%
                        mutate(linguagem = "py")

#plotando queda de popularidade por linguagem 
data.frame(rbind(dif_popularidade_java, dif_popularidade_py)) %>% 
  ggplot(aes(x = linguagem, ymin = X2.5., ymax = X97.5., color = linguagem)) + 
  geom_errorbar(width = .2)+
  ggtitle("Diferença de popularidade 2016 - 2017")

```
#Existe alguma correlação entre a popularidade das linguagens?


```{r}
java = filter(amostra, file_extension == "java")
py = filter(amostra, file_extension == "py")

popularidade_java_python = data.frame(popularidade_java_python = 1:1000) %>% 
            group_by(popularidade_java_python) %>% 
            do(data.frame(media_java = sample(java$users, 100) %>% mean(),
                          media_py = sample(py$users, 100) %>% mean()))

cor_java_python = bootstrap(popularidade_java_python, cor(media_java, media_py, method = c("pearson", "kendall", "spearman"))) %>% 
                        CI.percentile(probs = c(.025, .975)) %>% 
                        as.data.frame() 

#plotando correlação entre a popularidade de java e python 
data.frame(cor_java_python) %>% 
  ggplot(aes(x = "correlação", ymin = X2.5., ymax = X97.5.), color= "green") + 
  geom_errorbar(width = .2)+
  ggtitle("Correlação de popularidade 2016 - 2017")
```









